# 服务器性能优化

## 基础知识

- 网络带宽

``` shell

    单位是bps(bit per second)
    
			
```

## 系统性能定义

     系统性能包括Throughput(吞吐量)和Latency(系统延时),
     Latency越好，能支持的Throughput就会越高.因为Latency短说明处理速度快，于是就可以处理更多的请求。

### Throughput(吞吐量)
    
``` shell

    吞吐量代表了一段时间内的网络上传输的数据量的总和
    吞吐率则代表单位时间内的网络传输的数据量,同时也可以理解为单位时间内要处理客户的请求数量.吞吐率单位一般用byte/s.
    		
```

### Latency(系统延时)

``` shell

    Latency(系统延时)代表服务器处理请求的能力,和TPS(Transaction Per second)的概念是一致的.
    		
```

### 性能判断

- CPU利用率

``` shell

    如果CPU利用率不高,但是系统的Throughput和Latency上不去了,这说明我们的程序并没有忙于计算,而是忙于别的一些事，比如IO.
    CPU的利用率还要看内核态的和用户态的,内核态的一上去了,整个系统的性能就下来了.而对于多核CPU来说,CPU 0 是相当关键的,
    如果CPU 0的负载高,那么会影响其它核的性能,因为CPU各核间是需要有调度的,这靠CPU0完成
    		
```

- IO使用情况

``` shell

    IO使用情况和CPU使用情况一般是反着来的,CPU利用率高则IO不大.
    1.磁盘文件IO 2.网络IO 3.内存使用情况
    		
```

- 业务

``` shell

    通常一个小小的业务的调整可以很大程度得减缓服务器的压力
    1.在高并发情况下保持数据一致性是一个瓶颈,单单只是静态的请求没有问题,但请求引发的一系列业务操作就有压力,
    常用的方法:将数据请求不进行立刻处理,采用异步的方式,数据先保存,再不同的线程中根据不同的业务进行处理(水平扩展)
    
			
```

- 数据库

``` shell

    数据分区
        1.可以按照逻辑分类,将一张表拆成多张有一样的字段但是不同种类的表,这样可以提高查询的速度.	
```

- 负载均衡

``` shell
       1. 需要有任务调度(分配)系统,监控各个服务器的负载情况,调度系统需要考虑到cpu情况,磁盘IO,内存使用率,并发高,内存换页率
        等情况,任务调度系统还要任务队列,不能丢任务,要持久化,支持批量的方式分配给计算服务器.需要一些如Live-Standby或是
        failover等高可用性的技术防止任务调度系统崩溃.
        
       2.通过抢占式的方式进行负载均衡,由下游的计算服务器申请向任务服务器拿任务.
       
```

- 批量处理

``` shell
    将相同的请求进行批量的处理,批量处理为解决数据库操作以及磁盘IO一次性太频繁.比如,大家同时购买同一个商品,
    没有必要你买一个我就写一次数据库,完全可以收集到一定数量的请求.一次操作.
    批量处理的系统一般都会设置上两个阀值,一个是作业量,另一个是timeout,只要有一个条件满足,就会开始提交处理.
       
```

- 水平扩展

``` shell
    系统设计一定要很容易得进行水平扩展,当系统的性能有问题只要增加服务器个数就行了.
       
```